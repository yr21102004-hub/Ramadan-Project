{% extends "layout.html" %}

{% block content %}
<section class="section-padding" style="margin-top: 80px;">
    <div class="container">
        <div
            style="background: var(--surface-light); padding: 40px; border-radius: 20px; max-width: 600px; margin: 0 auto; border: 1px solid var(--primary); text-align: center;">
            <h2 class="section-title">إعداد المصادقة الثنائية (2FA)</h2>
            <div class="divider center-divider"></div>

            <p style="margin-bottom: 30px; color: var(--text-muted);">
                قم بزيادة أمان حسابك عن طريق تفعيل المصادقة الثنائية. امسح رمز الاستجابة السريعة (QR Code) باستخدام
                تطبيق Google Authenticator أو Microsoft Authenticator.
            </p>

            <div
                style="background: white; padding: 20px; display: inline-block; border-radius: 10px; margin-bottom: 30px;">
                <img src="data:image/png;base64,{{ qr_code }}" alt="QR Code" style="display: block;">
            </div>

            <div style="background: var(--surface); padding: 15px; border-radius: 10px; margin-bottom: 30px;">
                <p style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 5px;">الرمز السري (في حال تعذر
                    المسح):</p>
                <code
                    style="color: var(--primary); font-size: 1.2rem; font-weight: bold; letter-spacing: 2px;">{{ secret }}</code>
            </div>

            <form action="{{ url_for('toggle_2fa') }}" method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                {% if current_user.two_factor_enabled %}
                <input type="hidden" name="action" value="disable">
                <button type="submit" class="btn btn-outline" style="border-color: #ff4a4a; color: #ff4a4a;">تعطيل
                    المصادقة الثنائية</button>
                {% else %}
                <input type="hidden" name="action" value="enable">
                <button type="submit" class="btn btn-primary btn-block">تفعيل الآن</button>
                {% endif %}
            </form>

            <div style="margin-top: 20px;">
                <a href="{{ url_for('admin') }}" style="color: var(--text-muted);">العودة للوحة التحكم</a>
            </div>
        </div>
    </div>
</section>
{% endblock %}